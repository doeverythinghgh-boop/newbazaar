<style>
  /* ููุงุญุธุฉ: ูุง ูุณูุญ ุจุงุณุชุฎุฏุงู ุชุฃุซูุฑุงุช hover ูู ูุฐุง ุงููุดุฑูุน. */

  /* === ุชุตููู ุฌุฏูุฏ ููุญุณูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู === */

  /* 1. ุฎูููุฉ ุงูุตูุญุฉ ูุชุฎุทูุทูุง ุงูุนุงู */
  @keyframes login_gradient-animation {
    0% {
      background-position: 0% 50%;
    }

    50% {
      background-position: 100% 50%;
    }

    100% {
      background-position: 0% 50%;
    }
  }

  .login_page-wrapper {
    font-family: "Tajawal", sans-serif;
    /* ุฌุฏูุฏ: ุฎูููุฉ ูุชุญุฑูุฉ ุฌุฐุงุจุฉ */
    background-size: 400% 400%;
    animation: login_gradient-animation 15s ease infinite;
    min-height: 100vh;
    display: flex;
    /* โ ุชุนุฏูู: ุชุบููุฑ ุทุฑููุฉ ุงููุญุงุฐุงุฉ ุงูุนููุฏูุฉ */
    align-items: flex-start;
    /* ูุญุงุฐุงุฉ ุงููุญุชูู ุฅูู ุงูุฃุนูู */
    justify-content: center;
    padding: 20px;
    /* โ ุชุนุฏูู: ุฅุถุงูุฉ ุญุดู ุนููู ูุฏูุน ุงููููุฐุฌ ููุฃุณูู ูููููุง */
    box-sizing: border-box;
  }

  /* 2. ุญุงููุฉ ุงููููุฐุฌ ุงูุฑุฆูุณูุฉ (ุงูุจุทุงูุฉ) */
  .login_container {
    background-color: var(--bg-color-white);
    width: 100%;
    /* ุชุนุฏูู: ุฅุฒุงูุฉ ุงูุงุฑุชูุงุน ุงูุฃุฏูู ุงูุซุงุจุช ููุชูุงุณุจ ูุน ุงููุญุชูู */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0;
    /* ุฅุฒุงูุฉ ุงูุญุดู ูู ูุฐู ุงูุญุงููุฉ */
    background: none;
    /* ุฌุนู ูุฐู ุงูุญุงููุฉ ุดูุงูุฉ */
  }

  /* 3. ุนููุงู ุงููููุฐุฌ (ุชุณุฌูู ุงูุฏุฎูู) */
  .login_container h2 {
    margin-top: 0;
    margin-bottom: 0px;
    /* ุฒูุงุฏุฉ ุงููุณุงูุฉ ุงูุณูููุฉ */
    color: var(--dark-blue);
    /* ููู ุฃุบูู ูุฃูุซุฑ ูุถูุญูุง */
    font-size: clamp(28px, 6vw, 36px);
    /* ุชูุจูุฑ ุญุฌู ุงูุฎุท */
    font-weight: 700;
    text-align: center;
  }

  /* 4. ุงููููุฐุฌ ููุณู */
  .login_container form {
    width: 100%;
    max-width: 420px;
    /* ุชุนุฏูู ุงูุนุฑุถ ุงูุฃูุตู */
    /* ุฌุฏูุฏ: ุชุฃุซูุฑ ุฒุฌุงุฌู ุดูุงู */
    background-color: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 40px;
    border-radius: 20px;
    /* ุญูุงู ุฃูุซุฑ ุฏุงุฆุฑูุฉ */
    /* ุฌุฏูุฏ: ุธู ุฃูุซุฑ ูุนููุฉ ูุนูููุง */
    box-shadow: var(--shadow-soft);
    border: 1px solid var(--border-color-soft);
  }

  /* 5. ูุฌููุนุฉ ุญูู ุงูุฅุฏุฎุงู (ุงูุนููุงู ูุงูุญูู) */
  .login_form-group {
    margin-bottom: 20px;
    text-align: right;
    /* Align labels to the right */
    position: relative;
    /* ููู ููุถุน ุงูุฃููููุฉ ุจุงูุฏุงุฎู */
  }

  .login_form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark-blue);
    /* ููู ุฑูุงุฏู ุฏุงูู */
    font-size: 0.9rem;
  }

  /* 6. ุญููู ุงูุฅุฏุฎุงู */
  .login_form-group input {
    width: 100%;
    /* ุชุนุฏูู: ุงูุนุฑุถ ุงููุงูู ููุญุงููุฉ */
    padding: 14px 45px 14px 15px;
    /* ูุณุงุญุฉ ููุฃููููุฉ ุนูู ุงููููู */
    border: 1px solid var(--border-color-input);
    /* ููู ุฅุทุงุฑ ุฃูุชุญ */
    border-radius: 10px;
    /* ุฒูุงุฏุฉ ุฏุงุฆุฑูุฉ ุงูุญูุงู */
    box-sizing: border-box;
    font-family: "Tajawal", sans-serif;
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
    background-color: var(--bg-color-white);
    /* ุชุนุฏูู: ุฎูููุฉ ุจูุถุงุก ูููุฉ */
  }

  /* ุญุงููุฉ ุงูุฃููููุฉ ุฏุงุฎู ุญูู ุงูุฅุฏุฎุงู ูู password */
  .login_password-wrapper {
    position: relative;
  }

  /* Adjust password input padding to make space for the icon */
  .login_password-wrapper input[type="password"],
  .login_password-wrapper input[type="text"] {
    /* ุชู ุฅูุบุงุก ูุฐู ุงููุงุนุฏุฉ ููุง ูุฃููุง ูุชุนุงุฑุถุฉ ูุน #login_password ูุณุฃุนุชูุฏ ุนูู id ููุท */
    /* padding-left: 40px; */
  }

  /* ุฃููููุงุช ุญููู ุงูุฅุฏุฎุงู (ูู ุญุงูุฉ ุฑูู ุงููุงุชู) */
  .login_form-group .fa-phone,
  .login_form-group .fa-user {
    /* ุชุนุฏูู: ุชุญุณูู ูุญุงุฐุงุฉ ุงูุฃููููุฉ */
    position: absolute;
    top: 50%;
    right: 15px;
    /* ูููููู ูู RTL */
    transform: translateY(calc(-50% + 14px));
    /* ุถุจุท ุงููุญุงุฐุงุฉ ุงูุนููุฏูุฉ ุจุฏูุฉ */
    color: var(--icon-color);
    cursor: pointer;
  }

  /* Style for input fields with validation errors */
  .login_form-group input.login_input-error {
    border-color: var(--danger-color);
    /* Red border for error */
  }

  .login_form-group input.login_input-error:focus {
    box-shadow: 0 0 0 3px var(--danger-color-light);
    /* Red shadow on focus */
  }

  /* Style for the error message below the input */
  .login_error-message {
    color: var(--danger-color);
    /* Red color for error text */
    font-size: 12px;
    margin-top: 5px;
    min-height: 15px;
    /* Reserve space to prevent layout shifts */
  }

  .login_form-group input:focus {
    outline: none;
    border-color: var(--primary-color);
    /* ุชุนุฏูู: ููู ุฃุฒุฑู ูุชูุงุณู */
    box-shadow: var(--shadow-focus);
  }

  /* 7. ุฒุฑ ุชุณุฌูู ุงูุฏุฎูู */
  .login_btn {
    width: 100%;
    padding: 15px;
    font-size: clamp(16px, 4vw, 18px);
    /* Responsive font size */
    margin-top: 10px;
    border: none;
    color: white;
    background-color: var(--primary-color);
    box-shadow: 0 4px 15px var(--primary-color-light),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    border-radius: 10px;
    /* ููุถู ุฅุถุงูุฉ ุญูุงู ุฏุงุฆุฑูุฉ ููุชูุงุณู ูุน ุงูุญููู */
  }

  .login_btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 8px var(--primary-color-light);
  }

  /* 8. ุชุฐููู ุงููููุฐุฌ (ุฑูุงุจุท ุฅุถุงููุฉ) */
  .login_form-footer {
    margin-top: 25px;
    font-size: 14px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
  }

  /* ุฑุงุจุท "ุณุฌู ุงูุขู": ูุธูุฑ ูุฅุฌุฑุงุก ุซุงููู ุฃุณุงุณู */
  .login_form-footer-link {
    color: var(--primary-color);
    /* ููู ุฃุฒุฑู ูุงุถุญ */
    font-size: 14px;
    /* ุชุนุฏูู: ุชูุญูุฏ ุญุฌู ุงูุฎุท */
    text-decoration: none;
  }

  /* ุฑุงุจุท "ุงูุฏุฎูู ูุถูู": ูุธูุฑ ูุฎูุงุฑ ุจุฏูู ูุฃูู ุฃูููุฉ */
  .login_guest-link {
    color: var(--text-color-light);
    /* ููู ุฑูุงุฏู ูุฌุนูู ุฃูู ุจุฑูุฒูุง */
    font-size: 14px;
    border-top: 1px solid var(--border-color);
    /* ุฎุท ูุงุตู ุฃุบูู ููููุงู */
    padding-top: 15px;
    /* ูุณุงูุฉ ููู ุงูุฑุงุจุท */
    width: 100%;
    /* ุฌุนูู ููุชุฏ ุนูู ุนุฑุถ ุงูุญุงููุฉ */
    text-align: center;
    /* ุชูุณูุท ุงููุต */
    text-decoration: none;
  }

  /* ุฃููููุฉ ุชุจุฏูู ูููุฉ ุงููุฑูุฑ */
  .login_toggle-password {
    position: absolute;
    top: 50%;
    left: 15px;
    /* ูููุณุงุฑ ูู RTL */
    transform: translateY(calc(-50% + 14px));
    /* ุถุจุท ุงููุญุงุฐุงุฉ ุงูุนููุฏูุฉ ุจุฏูุฉ */
    color: var(--icon-color);
    cursor: pointer;
  }

  /* ุชุนุฏูู ุญูู ูููุฉ ุงููุฑูุฑ ููุถุน ุงูุฃููููุฉ ุนูู ุงููุณุงุฑ */
  #login_password {
    padding-left: 45px;
    /* ูุณุงุญุฉ ูุฃููููุฉ ุงูุนูู ุนูู ุงููุณุงุฑ */
  }

  .login_form-footer a strong {
    font-weight: 700;
  }

  /* === Back to Home Button (in Header) - ุชู ุงูุฅุจูุงุก ุนููู ููุง ูู ูููู ุนูุตุฑ ููุฏุฑ ูููุณ ุฌุฒุกุงู ูู ุงููููุฐุฌ === */
  .back-to-home-btn {
    display: flex;
    flex-direction: column;
    /* ุฌุนู ุงูุฃููููุฉ ูุงููุต ุจุชุฑุชูุจ ุนููุฏู */
    align-items: center;
    gap: 2px;
    /* ุชูููู ุงููุณุงูุฉ ุจูู ุงูุฃููููุฉ ูุงููุต */
    font-family: "Tajawal", sans-serif;
    font-weight: 600;
    color: var(--dark-blue);
    /* โ ุชุนุฏูู: ุชุบููุฑ ููู ุงูุฒุฑ ุฅูู ุงูุฃุฒุฑู */
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 20px;
    transition: background-color 0.3s, color 0.3s;
  }

  .back-to-home-btn i {
    font-size: 16px;
    margin-bottom: 2px;
    /* ุฅุถุงูุฉ ูุณุงูุฉ ุตุบูุฑุฉ ุฃุณูู ุงูุฃููููุฉ */
  }

  .back-to-home-btn span {
    font-size: 12px;
    /* ุชุตุบูุฑ ุญุฌู ุฎุท ุงููุต */
    white-space: nowrap;
    /* ููุน ุงููุต ูู ุงูุงููุณุงู ุฅูู ุณุทุฑูู */
  }

  /* Media query for very small screens */
  @media (max-width: 480px) {
    .login_container form {
      padding: 30px 25px;
      /* ุชูููู ุงูุญุดู ููุดุงุดุงุช ุงูุตุบูุฑุฉ ุฌุฏูุง */
      /* ุฌุฏูุฏ: ุฅุฒุงูุฉ ุงูุธู ูุงูุญุฏูุฏ ุนูู ุงูุดุงุดุงุช ุงูุตุบูุฑุฉ ุฌุฏูุง */
      box-shadow: none;
      border: none;
      background-color: transparent;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      /* For Safari compatibility */
    }

    .login_form-group {
      margin-bottom: 15px;
    }
  }
</style>

<div id="header-container1" style="height: 70px"></div>

<div id="login_form-wrapper" class="login_page-wrapper" style="display: none">
  <div id="login_form-container" class="login_container">
    <h2 id="login_title">ุชุณุฌูู ุงูุฏุฎูู</h2>
    <form id="login_form">
      <div id="login_phone-form-group" class="login_form-group">
        <label for="login_phone"><i class="fas fa-phone"></i> ุฑูู ุงููุงุชู</label>
        <input type="tel" id="login_phone" name="login_phone" required />
        <div id="login_phone-error" class="login_error-message"></div>
      </div>
      <div id="login_password-form-group" class="login_form-group">
        <label for="login_password"><i class="fas fa-lock"></i> ูููุฉ ุงููุฑูุฑ</label>
        <input type="password" id="login_password" name="login_password" required />
        <i class="fas fa-eye login_toggle-password" id="login_togglePassword"></i>
        <div id="login_password-error" class="login_error-message"></div>
      </div>
      <button type="submit" class="button login_btn">ุชุณุฌูู ุงูุฏุฎูู</button>
      <div id="login_form-footer" class="login_form-footer">
        <a href="register.html" id="login_go-to-register-link" class="login_form-footer-link">ููุณ ูุฏูู ุญุณุงุจุ <strong>ุณุฌู
            ุงูุขู</strong></a>
        <a id="login_guest-btn" class="login_guest-link">ุฃู ููููู <strong>ุงูุฏุฎูู ูุถูู</strong> ูุชุตูุญ ุงูููุชุฌุงุช</a>
      </div>
    </form>
  </div>
</div>
<script>
  /**
 * @description ุฏุงูุฉ ุงูุชููุฆุฉ ุงูุฑุฆูุณูุฉ ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู.
 * ุชุชุญูู ุฃููุงู ูู ุญุงูุฉ ุงููุณุชุฎุฏู ูุชุนุฑุถ ุงููููุฐุฌ ููุท ุฅุฐุง ูู ููู ูุณุฌูุงู ุฏุฎููู.
 * ุชููู ุจุฑุจุท ูุนุงูุฌุงุช ุงูุฃุญุฏุงุซ ุงููุทููุจุฉ ููููุฐุฌ ุงูุฏุฎูู.
 * @async
 * @function loadPage
 * @param {object} [params] - ุจูุงูุงุช (ุญุงูุฉ) ูููู ุชูุฑูุฑูุง ูู ุงูุตูุญุฉ ุงูุณุงุจูุฉ.
 * @returns {Promise<void>} - ูุนุฏ (Promise) ูุง ููุฑุฌุน ูููุฉ ุนูุฏ ุงูุงูุชูุงู.
 */
  async function loadPage(params) {
    try {
      // โ ุฅุตูุงุญ: ุชุญุฏูุซ userSession ูู localStorage ูุถูุงู ุฃููุง ูุณุชุฎุฏู ุฃุญุฏุซ ุญุงูุฉ.
      // ูุฐุง ูููุน ุงูููุฏ ูู ุงูุงุนุชูุงุฏ ุจุฃู ุงููุณุชุฎุฏู ูุง ูุฒุงู ูุณุฌูุงู ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
      // ุฅุฐุง ูุงู ุงููุชุบูุฑ ุงูุนุงู userSession ูู ูุชู ุชุญุฏูุซู ุจุนุฏ.
      userSession = JSON.parse(localStorage.getItem("loggedInUser")) || null;

      // ุงูุชุญูู ูู ูุฌูุฏ ูุณุชุฎุฏู ูุณุฌู ุฏุฎููู ุจุงููุนู
      if (Number(userSession?.is_seller) >= 1) {
        // ูุญุงููุฉ ุชููุฆุฉ ุงูุฅุดุนุงุฑุงุช ูููุณุชุฎุฏู ุงูุญุงูู ุฅุฐุง ูุงู ูุณุฌูุงู ุฏุฎููู.
        if (typeof initializeNotifications === "function") {
          initializeNotifications();
        }
        // ุฅููุงู ุงูุชูููุฐ ูุฅุชุงุญุฉ ุงููุฑุตุฉ ูุฅุนุงุฏุฉ ุงูุชูุฌูู (ุงูููุฑูุถ ุฃู ูุชู ุฅุนุงุฏุฉ ุงูุชูุฌูู ูู ููุงู ุขุฎุฑ)
        return;
      }

      // ุฅุธูุงุฑ ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู ููุท ุฅุฐุง ูู ููู ููุงู ูุณุชุฎุฏู ูุณุฌู.
      const loginFormWrapper = document.getElementById("login_form-wrapper");
      if (loginFormWrapper) {
        // ุงุณุชุฎุฏุงู 'flex' ูุฃูู ูุชูุงูู ูุน CSS
        loginFormWrapper.style.display = "flex";
      }

      // ุฅุนุฏุงุฏ ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู
      login_setupLoginForm();

    } catch (error) {
      console.error("๐ซ ุญุฏุซ ุฎุทุฃ ูู ุฏุงูุฉ loadPage:", error);
      // ูููู ุนุฑุถ ุฎุทุฃ ุนุงู ูููุณุชุฎุฏู ุจุงุณุชุฎุฏุงู SweetAlert2
      if (typeof Swal !== "undefined") {
        Swal.fire({
          icon: "error",
          title: "ุฎุทุฃ ูู ุชุญููู ุงูุตูุญุฉ",
          text: "ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ูุงุญูุงู.",
        });
      }
    }
  }

  /**
   * @description ุชููู ุจุฅุนุฏุงุฏ ูุงูุฉ ูุนุงูุฌุงุช ุงูุฃุญุฏุงุซ ููููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู.
   * ุชุดูู: ุชุจุฏูู ุฑุคูุฉ ูููุฉ ุงููุฑูุฑุ ุชูููุฉ ุฑูู ุงููุงุชูุ ููุนุงูุฌ ุญุฏุซ ุงูุฅุฑุณุงู.
   * @function login_setupLoginForm
   * @returns {void}
   */
  function login_setupLoginForm() {
    try {
      // ุงูุญุตูู ุนูู ุนูุงุตุฑ ุงููููุฐุฌ
      const loginForm = document.getElementById("login_form");
      if (!loginForm) return;

      const loginPhoneInput = document.getElementById("login_phone");
      const loginPasswordInput = document.getElementById("login_password");
      const loginTogglePassword = document.getElementById("login_togglePassword");
      const loginGuestBtn = document.getElementById("login_guest-btn");

      // 1. ุฅุถุงูุฉ ูุธููุฉ ุชุจุฏูู ุฑุคูุฉ ูููุฉ ุงููุฑูุฑ
      if (loginTogglePassword && loginPasswordInput) {
        loginTogglePassword.addEventListener("click", function () {
          // ุชุจุฏูู ููุน ุงูุญูู
          const type =
            loginPasswordInput.getAttribute("type") === "password" ? "text" : "password";
          loginPasswordInput.setAttribute("type", type);
          // ุชุจุฏูู ุฃููููุฉ ุงูุนูู
          this.classList.toggle("fa-eye");
          this.classList.toggle("fa-eye-slash");
        });
      }

      // 2. ูุนุงูุฌ ุญุฏุซ ุงูุฅุฏุฎุงู ูุฑูู ุงููุงุชู (ููุชูููุฉ)
      if (loginPhoneInput) {
        loginPhoneInput.addEventListener("input", function (e) {
          // ุงุณุชุฎุฏุงู ุฏุงูุฉ `normalizeDigits` ูุชุญููู ุงูุฃุฑูุงู ุงูููุฏูุฉ (ูุซู 'ููกูข') ุฅูู ุฅูุฌููุฒูุฉ ('012').
          const normalized = normalizeDigits(e.target.value);
          // ุจุนุฏ ุงูุชุญูููุ ูุชู ุงุณุชุฎุฏุงู ุชุนุจูุฑ ููุทู ูุฅุฒุงูุฉ ุฃู ุญุฑู ููุณ ุฑูููุง (0-9).
          e.target.value = normalized.replace(/[^0-9]/g, "");
        });
      }

      // 3. ูุนุงูุฌ ุญุฏุซ ุฅุฑุณุงู ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู
      loginForm.addEventListener("submit", login_handleSubmit);

      // 4. ุฑุจุท ุงูุญุฏุซ ุจุฒุฑ "ุงูุฏุฎูู ูุถูู".
      if (loginGuestBtn) {
        loginGuestBtn.addEventListener("click", login_handleGuestLogin);
      }

    } catch (error) {
      console.error("๐ซ ุญุฏุซ ุฎุทุฃ ูู ุฏุงูุฉ login_setupLoginForm:", error);
    }
  }


  /**
   * @description ูุนุงูุฌ ุญุฏุซ ุฅุฑุณุงู ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู.
   * ูููู ุจุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุชุ ุซู ูุชูุงุตู ูุน ุงููุงุฌูุฉ ุงูุฎูููุฉ ููุชุญูู ูู ุจูุงูุงุช ุงูุฏุฎูู.
   * @event submit
   * @async
   * @param {Event} e - ูุงุฆู ุงูุญุฏุซ ูููุน ุงูุณููู ุงูุงูุชุฑุงุถู.
   * @returns {Promise<void>}
   */
  async function login_handleSubmit(e) {
    try {
      console.log(
        "%c[Login Page] ุชู ุงูุถุบุท ุนูู ุฒุฑ ุชุณุฌูู ุงูุฏุฎูู.",
        "color: blue; font-weight: bold;"
      );
      // ููุน ุงูุณููู ุงูุงูุชุฑุงุถู ูููููุฐุฌ (ุงูุฐู ูููู ุจุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ).
      e.preventDefault();

      const loginPhoneInput = document.getElementById("login_phone");
      const loginPasswordInput = document.getElementById("login_password");

      // 1. ูุณุญ ุฃู ุฑุณุงุฆู ุฎุทุฃ ุณุงุจูุฉ
      if (typeof clearError === "function") {
        clearError(loginPhoneInput);
        clearError(loginPasswordInput);
      }

      // 2. ุงูุญุตูู ุนูู ุงูููู ูุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช
      const phoneValue = loginPhoneInput.value.trim();
      const passwordValue = loginPasswordInput.value.trim();
      let loginIsValid = true;

      // ุงูุชุญูู ูู ุฑูู ุงููุงุชู
      if (phoneValue === "") {
        showError(loginPhoneInput, "ุฑูู ุงููุงุชู ูุทููุจ.");
        loginIsValid = false;
      } else if (phoneValue.length < 11) {
        showError(loginPhoneInput, "ุฑูู ุงููุงุชู ูุฌุจ ุฃูุง ููู ุนู 11 ุฑูููุง.");
        loginIsValid = false;
      }

      // ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
      if (passwordValue === "") {
        showError(loginPasswordInput, "ูููุฉ ุงููุฑูุฑ ูุทููุจุฉ.");
        loginIsValid = false;
      } else if (passwordValue.length < 4) {
        showError(loginPasswordInput, "ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃูุง ุชูู ุนู 4 ุฃุญุฑู.");
        loginIsValid = false;
      }

      // 3. ุฅุฐุง ูุงูุช ุฌููุน ุงููุฏุฎูุงุช ุตุงูุญุฉ
      if (loginIsValid) {
        console.log("[Login Page] ุงููููุฐุฌ ุตุงูุญุ ุฌุงุฑู ุงูุชุญูู ูู ุจูุงูุงุช ุงูุฏุฎูู...");

        // ุนุฑุถ ูุงูุฐุฉ ููุจุซูุฉ ุชููุฏ ุจุฃู ุนูููุฉ ุชุณุฌูู ุงูุฏุฎูู ุฌุงุฑูุฉ.
        Swal.fire({
          title: "ุฌุงุฑู ุชุณุฌูู ุงูุฏุฎูู...",
          text: "ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ ููููุงู.",
          allowOutsideClick: false,
          didOpen: () => {
            // ุฅุธูุงุฑ ุฃููููุฉ ุงูุชุญููู.
            Swal.showLoading();
          },
          customClass: { popup: 'fullscreen-swal' }, // ุชุทุจูู ุงูููุท ุงููุฎุตุต
        });

        // 4. ุงูุชูุงุตู ูุน ุงูุฎุงุฏู ููุชุญูู
        const verificationResult = await verifyUserPassword(
          phoneValue,
          passwordValue
        );

        // 5. ูุนุงูุฌุฉ ูุชูุฌุฉ ุงูุชุญูู
        if (verificationResult && !verificationResult.error) {
          console.log(
            "[Login Page] ุชุณุฌูู ุฏุฎูู ูุงุฌุญ. ุฌุงุฑู ุงุณุชุฏุนุงุก handleLoginSuccess..."
          );
          login_handleLoginSuccess(verificationResult);
        } else {
          // ุฅุฐุง ูุดู ุงูุชุญูู
          console.error(
            "[Login Page] ูุดู ุชุณุฌูู ุงูุฏุฎูู:",
            verificationResult?.error || "ุฎุทุฃ ุบูุฑ ูุญุฏุฏ"
          );
          Swal.close();
          const errorMessage =
            "ูููุฉ ุงููุฑูุฑ ูุฑูู ุงููุงุชู ุบูุฑ ูุชูุงูููู. ุชุฃูุฏ ูู ุตุญุชูู";
          if (typeof showError === "function") {
            showError(loginPasswordInput, errorMessage);
          }
        }
      }
    } catch (error) {
      console.error("๐ซ ุญุฏุซ ุฎุทุฃ ูู ุฏุงูุฉ login_handleSubmit:", error);
      // ุฅุบูุงู ูุงูุฐุฉ ุงูุชุญููู ูุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ
      if (typeof Swal !== "undefined") {
        Swal.close();
        Swal.fire({
          icon: "error",
          title: "ูุดู ูู ุนูููุฉ ุงูุฏุฎูู",
          text: "ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน ุฃุซูุงุก ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎูู.",
        });
      }
    }
  }

  /**
   * @description ูุชุนุงูู ูุน ุงูุฅุฌุฑุงุกุงุช ุงูุชู ุชุญุฏุซ ุจุนุฏ ุชุณุฌูู ุฏุฎูู ูุงุฌุญ ูููุณุชุฎุฏู.
   * @function login_handleLoginSuccess
   * @param {object} user - ูุงุฆู ุงููุณุชุฎุฏู ุงููุณุฌู ุฏุฎููู.
   * @async
   * @returns {Promise<void>}
   */
  async function login_handleLoginSuccess(user) {
    try {
      console.log(
        "%c[Login Page] ุฏุฎููุง ุฏุงูุฉ login_handleLoginSuccess. ุจูุงูุงุช ุงููุณุชุฎุฏู:",
        "color: green;",
        user
      );

      // 1. ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ูุชุญุฏูุซ ุงูุฌูุณุฉ
      localStorage.setItem("loggedInUser", JSON.stringify(user));
      userSession = user; // ุชุญุฏูุซ ุงููุงุฆู ุงูุนุงู ูุฌูุณุฉ ุงููุณุชุฎุฏู
      setUserNameInIndexBar();
      // 2. ุฅุนุฏุงุฏ ุฅุดุนุงุฑุงุช FCM ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุคููุงู
      if (Number(userSession?.is_seller) >= 1) {
        return;
      /*  console.log("[Login Page] ุงููุณุชุฎุฏู ูุคููุ ุฌุงุฑู ุงุณุชุฏุนุงุก setupFCM() ุงูุขู...");
        if (typeof setupFCM === "function") {
          await setupFCM();
          await login_askForNotificationPermission();
        }*/
      } else {
        console.log(
          "[Login Page] ุงููุณุชุฎุฏู ุบูุฑ ูุคูู ููุฅุดุนุงุฑุงุชุ ุชู ุชุฎุทู ุงุณุชุฏุนุงุก setupFCM()."
        );
      }

      // 3. ุนุฑุถ ุฑุณุงูุฉ ุงูุชุฑุญูุจ ูุงูุงูุชูุงู ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
      Swal.fire({
        title: `๐ ุฃููุงู ุจูุ ${userSession.username}! ๐`,
        html: `
        <p style="font-size: 1.1rem; color: #333;">ุฃูุช ุงูุขู ุฌุงูุฒ ูุชุฌุฑุจุฉ ุชุณูู ูุฑูุฏุฉ!</p>
        <div style="text-align: right; margin-top: 20px; padding-right: 15px; font-size: 1rem;">
          <p style="margin-bottom: 10px;">๐๏ธ ุชุตูุญ ุขูุงู ุงูููุชุฌุงุช ุจุณูููุฉ.</p>
          <p style="margin-bottom: 10px;">๐ฐ ุชูุชุน ุจุงูุฎุตููุงุช ูุงูุนุฑูุถ ุงูุญุตุฑูุฉ.</p>
          <p>โจ ุงูุชุดู ูู ูุง ูู ุฌุฏูุฏ ูู ุณููุณ ุจุงุฒุงุฑ.</p>
        </div>
      `,
        icon: "success",
        allowOutsideClick: false, // ููุน ุงูุฅุบูุงู ุนูุฏ ุงูููุฑ ุฎุงุฑุฌ ุงูุฑุณุงูุฉ
        confirmButtonText: "ุงุจุฏุฃ ุงูุชุณูู ุงูุขู!",
        confirmButtonColor: "#3b82f6",
        customClass: { popup: 'fullscreen-swal' }, // ุชุทุจูู ุงูููุท ุงููุฎุตุต
      }).then((result) => {
        // ุนูุฏ ุงูุถุบุท ุนูู ุงูุฒุฑุ ุงูุชูู ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
        if (result.isConfirmed) {
          if (typeof mainLoader === "function") {
            mainLoader("./pages/home.html", "index-home-container", 0, undefined, "hiddenHomeIcon", true);
          }
        }
      });

    } catch (error) {
      console.error("๐ซ ุญุฏุซ ุฎุทุฃ ูู ุฏุงูุฉ login_handleLoginSuccess:", error);
    }
  }

  /**
   * @description ุชุทูุจ ุฅุฐู ุงูุฅุดุนุงุฑุงุช ูู ุงููุธุงู ุงูุฃุตูู (Native) ุฅุฐุง ูุงู ุงูุชุทุจูู ูุนูู ุถูู ุจูุฆุฉ Android.
   * @function login_askForNotificationPermission
   * @async
   * @returns {Promise<void>} - ููุฑุฌุน ูุนุฏูุง (Promise) ูุง ููุฑุฌุน ูููุฉ ุนูุฏ ุงูุงูุชูุงู.
   */
  async function login_askForNotificationPermission() {
    try {
      // ุงูุชุญูู ูู ูุฌูุฏ ุงููุงุฆู 'Android' ููุชุฃูุฏ ูู ุฃู ุงูููุฏ ูุนูู ุฏุงุฎู ุชุทุจูู ุฃูุฏุฑููุฏ
      if (
        window.Android &&
        typeof window.Android.requestNotificationPermission === "function"
      ) {
        console.log(
          "Calling native function to request notification permission..."
        );
        window.Android.requestNotificationPermission();
      } else {
        console.log("ูุงุฌูุฉ ุงูุฃูุฏุฑููุฏ ุบูุฑ ูุชุงุญุฉ.");
      }
    } catch (error) {
      console.error("๐ซ ุญุฏุซ ุฎุทุฃ ูู ุฏุงูุฉ login_askForNotificationPermission:", error);
    }
  }

  /**
   * @description ูุนุงูุฌ ุนูููุฉ ุชุณุฌูู ุงูุฏุฎูู ูุถูู.
   * @function login_handleGuestLogin
   * @param {Event} event - ูุงุฆู ุงูุญุฏุซ ูููุน ุงูุณููู ุงูุงูุชุฑุงุถู ููุฑุงุจุท.
   * @returns {void}
   */
  function login_handleGuestLogin(event) {
    try {
      event.preventDefault(); // ููุน ุงูุฑุงุจุท ูู ุชุญุฏูุซ ุงูุตูุญุฉ
      console.log("[Auth] Logging in as a guest.");

      // ุฅูุดุงุก ูุงุฆู ูุณุชุฎุฏู ุถูู
      const guestUser = {
        username: "ุถูู",
        is_guest: true,
        user_key: "guest_user",
        is_seller: -1,
        notifications_key: null, // ุงูุถูู ููุณ ูู ููุชุงุญ ุฅุดุนุงุฑุงุช
        notifications_enabled: false, // ุงูุฅุดุนุงุฑุงุช ูุนุทูุฉ ููุถูู
      };

      // ุญูุธ ุจูุงูุงุช ุงูุถูู ูู localStorage ูุชุญุฏูุซ ุงูุฌูุณุฉ
      localStorage.setItem("loggedInUser", JSON.stringify(guestUser));
      userSession = guestUser;
      setUserNameInIndexBar();
      // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ุจุงููุงูู ูุชุญุฏูุซ ุงููุงุฌูุฉ
      if (typeof mainLoader === "function") {
        mainLoader(
          "./pages/home.html",
          "index-home-container",
          0,
          undefined,
          "hiddenHomeIcon"
        );
      }
    } catch (error) {
      console.error("๐ซ ุญุฏุซ ุฎุทุฃ ูู ุฏุงูุฉ login_handleGuestLogin:", error);
    }
  }

  loadPage();

  // ูุชู ุฅุฏุฑุงุฌ ูุฐุง ุงูุนูุตุฑ ุจุงูุทุฑููุฉ ุงููุชุจุนุฉ ูู ุงููุดุฑูุน (hgh_sec)
  insertUniqueSnapshot("../pages/header.html", "header-container1", 300);
</script>