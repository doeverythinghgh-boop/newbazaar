<!DOCTYPE html>
<html lang="ar" dir="rtl">
<!--
    @file register.html
    @description ØµÙØ­Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯.

    ØªØ­ØªÙˆÙŠ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ Ù†Ù…ÙˆØ°Ø¬ ÙŠØ³Ù…Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ù‡Ù… ÙˆØ±Ù‚Ù… Ù‡Ø§ØªÙÙ‡Ù… Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨.
    - ØªÙ‚ÙˆÙ… Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª.
    - ØªÙ†Ø´Ø¦ Ø±Ù‚Ù…Ù‹Ø§ ØªØ³Ù„Ø³Ù„ÙŠÙ‹Ø§ ÙØ±ÙŠØ¯Ù‹Ø§ (`user_key`) Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù….
    - ØªØ³ØªØ¯Ø¹ÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª (API) Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
  -->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ - Suez Bazaar</title>
  <!-- Link to shared styles -->
  <link rel="stylesheet" href="../style/variables.css" />
  <!-- âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù„ÙØ§Øª CSS Ø§Ù„Ù…Ù‚Ø³Ù…Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† style.css Ø§Ù„Ù‚Ø¯ÙŠÙ… -->
  <style>
/* Extracted from register-page.css */
.password-container {
  position: relative;
}
.password-container input {
  padding-left: 40px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± (Ù„Ù€ RTL) */
}
.toggle-password {
  position: absolute;
  left: 15px; /* Ù„Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
}
/* Extracted from login.css */
@keyframes gradient-animation {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.login-page-wrapper {
  font-family: "Tajawal", sans-serif;
  /* Ø¬Ø¯ÙŠØ¯: Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø¬Ø°Ø§Ø¨Ø© */
  background-size: 400% 400%;
  animation: gradient-animation 15s ease infinite;
  min-height: 100vh;
  display: flex; /* âœ… ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© */
  align-items: flex-start; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
  justify-content: center;
  padding: 20px; /* âœ… ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© Ø­Ø´Ùˆ Ø¹Ù„ÙˆÙŠ Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„Ø£Ø³ÙÙ„ Ù‚Ù„ÙŠÙ„Ù‹Ø§ */

  box-sizing: border-box;
}

.login-container {
  background-color: var(--bg-color-white);
  width: 100%;
  /* ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ø«Ø§Ø¨Øª Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 0; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
  background: none; /* Ø¬Ø¹Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø´ÙØ§ÙØ© */
}

.login-container h2 {
  margin-top: 0;
  margin-bottom: 40px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
  color: var(--dark-blue); /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ ÙˆØ£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ù‹Ø§ */
  font-size: clamp(28px, 6vw, 36px); /* ØªÙƒØ¨ÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
  font-weight: 700;
  text-align: center;
}

.login-container form {
  width: 100%;
  max-width: 420px; /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚ØµÙ‰ */
  /* Ø¬Ø¯ÙŠØ¯: ØªØ£Ø«ÙŠØ± Ø²Ø¬Ø§Ø¬ÙŠ Ø´ÙØ§Ù Ù…Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ±Ø§Øª */
  background-color: var(--bg-color-glass);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding: 40px;
  border-radius: 20px; /* Ø­ÙˆØ§Ù Ø£ÙƒØ«Ø± Ø¯Ø§Ø¦Ø±ÙŠØ© */
  /* Ø¬Ø¯ÙŠØ¯: Ø¸Ù„ Ø£ÙƒØ«Ø± Ù†Ø¹ÙˆÙ…Ø© ÙˆØ¹Ù…Ù‚Ù‹Ø§ */
  box-shadow: var(--shadow-interactive);
  border: 1px solid var(--border-color-soft);
}

.form-group {
  margin-bottom: 20px;
  text-align: right;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: bold;
  color: var(--dark-blue); /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ† */
  font-size: 0.9rem;
}

.form-group input {
  width: 100%; /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ø§ÙˆÙŠØ© */
  padding: 14px 45px 14px 15px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
  border: 1px solid var(--border-color-input); /* Ù„ÙˆÙ† Ø¥Ø·Ø§Ø± Ø£ÙØªØ­ */
  border-radius: 10px; /* Ø²ÙŠØ§Ø¯Ø© Ø¯Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø­ÙˆØ§Ù */
  box-sizing: border-box;
  font-family: "Tajawal", sans-serif;
  font-size: 16px;
  transition: border-color 0.3s, box-shadow 0.3s;
  background-color: var(--bg-color-white); /* ØªØ¹Ø¯ÙŠÙ„: Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù†Ù‚ÙŠØ© */
}

.form-group {
  position: relative;
}

.form-group .fa-phone,
.form-group .fa-user {
  /* ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø³ÙŠÙ† Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
  position: absolute;
  top: 50%;
  right: 15px; /* Ù„Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
  transform: translateY(calc(-50% + 14px)); /* Ø¶Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© Ø¨Ø¯Ù‚Ø© */
  color: var(--icon-color);
  cursor: pointer;

}

.login-btn {
  width: 100%;
  padding: 15px;
  font-size: clamp(16px, 4vw, 18px); /* Responsive font size */
  margin-top: 10px;
  border: none;
  color: var(--bg-color-white);
  /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø®Ù„ÙÙŠØ© */
  background-color: var(--primary-color); /* ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù„ÙˆÙ†ÙŠ Ø¨Ù…ØªØºÙŠØ± Ù…ÙˆØ­Ø¯ */
  box-shadow: var(--shadow-interactive), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
}
</style>



</head>

<body>


  <div class="login-page-wrapper">
    <div class="login-container">
      <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <form id="register-form" novalidate>
        <div class="form-group">
          <label for="username"><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…</label>
          <input type="text" id="username" name="username" required />
          <div id="username-error" class="error-message"></div>
        </div>
        <div class="form-group">
          <label for="phone"><i class="fa fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input type="tel" id="phone" name="phone" required />
          <div id="phone-error" class="error-message"></div>
        </div>
        <div class="form-group">
          <label for="password"><i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div class="password-container">
            <input type="password" id="password" name="password" required />
            <i class="fa fa-eye toggle-password" id="toggle-password-icon"></i>
          </div>
          <div id="password-error" class="error-message"></div>
          <small class="form-hint">ÙŠØ¬Ø¨ Ø£Ù† ØªØªÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ.</small>
        </div>
        <div class="form-group">
          <label for="address"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input type="text" id="address" name="address" />
          <div id="address-error" class="error-message"></div>
          <small class="form-hint">Ø§Ø®ØªÙŠØ§Ø±ÙŠ. ÙŠÙØ³ØªØ®Ø¯Ù… Ù„ØªØ³Ù‡ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„ÙŠÙƒ.</small>
        </div>

        <button type="submit" class="button login-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <div class="form-footer">
          <a href="login.html">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <strong>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</strong></a>
        </div>
      </form>

    </div>
  </div>

  <script>
    const form = document.getElementById("register-form");
    const username = document.getElementById("username");
    const phone = document.getElementById("phone");
    const password = document.getElementById("password");
    const address = document.getElementById("address");

    /**
     * ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ ÙØ±ÙŠØ¯ Ù…ÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø­Ø±Ù ØµØºÙŠØ±Ø© Ùˆ 4 Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©.
     * ÙŠØªÙ… Ø®Ù„Ø· Ø§Ù„Ø£Ø­Ø±Ù Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ø£Ù‚Ù„ Ù‚Ø§Ø¨Ù„ÙŠØ© Ù„Ù„ØªÙ†Ø¨Ø¤.
     * @returns {string} Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…ÙƒÙˆÙ† Ù…Ù† 8 Ø£Ø­Ø±Ù.
     */
    function generateSerialNumber() {
      const letters = "abcdefghijklmnopqrstuvwxyz";
      const digits = "0123456789";
      let chars = [];

      // 1. Ø¥Ø¶Ø§ÙØ© 4 Ø£Ø­Ø±Ù ØµØºÙŠØ±Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
      for (let i = 0; i < 4; i++) {
        chars.push(letters.charAt(Math.floor(Math.random() * letters.length)));
      }

      // 2. Ø¥Ø¶Ø§ÙØ© 4 Ø£Ø±Ù‚Ø§Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
      for (let i = 0; i < 4; i++) {
        chars.push(digits.charAt(Math.floor(Math.random() * digits.length)));
      }

      // 3. Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
      for (let i = chars.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [chars[i], chars[j]] = [chars[j], chars[i]]; // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±
      }

      // 4. Ø¯Ù…Ø¬ Ø§Ù„Ù…ØµÙÙˆÙØ© Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      return chars.join("");
    }

  

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„ØªÙ†Ù‚ÙŠØ© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
    phone.addEventListener("input", function (e) {
      let value = e.target.value;
      // ØªØ¹Ø±ÙŠÙ Ù‚Ø§Ù…ÙˆØ³ Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
      const hindiToArabic = {
        "Ù ": "0", "Ù¡": "1", "Ù¢": "2", "Ù£": "3", "Ù¤": "4",
        "Ù¥": "5", "Ù¦": "6", "Ù§": "7", "Ù¨": "8", "Ù©": "9",
      };

      // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
      value = value.replace(/[Ù -Ù©]/g, (d) => hindiToArabic[d]);

      // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø­Ø±Ù Ù„ÙŠØ³ Ø±Ù‚Ù…Ù‹Ø§ (0-9)
      value = value.replace(/[^0-9]/g, "");

      // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚Ù„
      e.target.value = value;
    });

    form.addEventListener("submit", async function (e) {
      e.preventDefault(); // Prevent form from submitting
      console.log('%c[Register] Form submitted.', 'color: blue;');
      let isValid = true;

      // --- Validation ---

      // 1. Username validation
      clearError(username);
      const usernameValue = username.value.trim();
      console.log('[Register] Validating username...');
      if (usernameValue === "") {
        showError(username, "Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨.");
        isValid = false;
      } else if (usernameValue.length < 8 || usernameValue.length > 30) {
        showError(username, "Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 8 Ùˆ 30 Ø­Ø±ÙÙ‹Ø§.");
        isValid = false;
      }

      // 2. Phone validation
      clearError(phone);
      const phoneValue = phone.value.trim();
      console.log('[Register] Validating phone number...');
      if (phoneValue === "") {
        showError(phone, "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨.");
        isValid = false;
      } else if (phoneValue.length < 11) {
        showError(phone, "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† 11 Ø±Ù‚Ù…Ù‹Ø§.");
        isValid = false;
      }

      // 3. Password validation
      clearError(password);
      const passwordValue = password.value.trim();
      console.log('[Register] Validating password...');
      if (passwordValue === "") {
        showError(password, "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©.");
        isValid = false;
      } else if (passwordValue.length < 4) {
        showError(password, "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
        isValid = false;
      }

      if (!isValid) {
        console.warn('[Register] Validation failed.');
        return;
      }

      // Password confirmation is now mandatory
      console.log('[Register] Prompting for password confirmation...');
      const { value: confirmedPassword } = await Swal.fire({
        title: "ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
        html: `
            <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ£ÙƒÙŠØ¯</p>
            <div class="password-container">
              <input type="password" id="swal-confirm-password" class="swal2-input" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
              <i class="fa fa-eye toggle-password" id="swal-toggle-confirm-password" style="top: 60%;"></i>
            </div>
          `,
        showCancelButton: true,
        confirmButtonText: "ØªØ£ÙƒÙŠØ¯",
        cancelButtonText: "Ø¥Ù„ØºØ§Ø¡",
        didOpen: () => {
          const confirmInput = document.getElementById('swal-confirm-password');
          const toggleIcon = document.getElementById('swal-toggle-confirm-password');
          confirmInput.focus();
          toggleIcon.addEventListener('click', () => {
            const isPassword = confirmInput.type === 'password';
            confirmInput.type = isPassword ? 'text' : 'password';
            toggleIcon.classList.toggle('fa-eye');
            toggleIcon.classList.toggle('fa-eye-slash');
          });
        },
        preConfirm: () => {
          const confirmValue = document.getElementById('swal-confirm-password').value;
          if (confirmValue !== password.value) {
            Swal.showValidationMessage("ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†!");
            return false;
          }
          return confirmValue;
        }
      });

      // Ø¥Ø°Ø§ Ø£Ù„ØºÙ‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø£ÙˆÙ‚Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
      if (!confirmedPassword) {
        console.log('[Register] Password confirmation cancelled by user.');
        return;
      }
      const userKey = generateSerialNumber(); // ğŸ”‘ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ
      console.log(`[Register] Generated new user_key: ${userKey}`);
      const newUser = {
        username: username.value.trim(),
        phone: phone.value.trim(),
        user_key: userKey, // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        password: password.value, // Ù‚Ø¯ ØªÙƒÙˆÙ† ÙØ§Ø±ØºØ©
        address: address.value.trim(), // Ù‚Ø¯ ØªÙƒÙˆÙ† ÙØ§Ø±ØºØ©
      };

      console.log('[Register] Sending new user data to API...', newUser);
      // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… SweetAlert2
      Swal.fire({
        title: "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...",
        text: "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹.",
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        },
      });

      try {
        const result = await addUser(newUser);
        Swal.close(); // Ø¥ØºÙ„Ø§Ù‚ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±

        if (result && result.message) {
          console.log('%c[Register] Registration successful.', 'color: green;', result);
          // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„Ù‡
          // âœ… Ø¥ØµÙ„Ø§Ø­: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ø£Ø¯Ø®Ù„Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
          const loggedInUserData = {
            username: newUser.username,
            phone: newUser.phone,
            user_key: newUser.user_key,
            Address: newUser.address, // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ø­ÙÙˆØ¸
            is_seller: 0 // Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹
          };
          localStorage.setItem("loggedInUser", JSON.stringify(loggedInUserData));

        
          console.log('[Register] User data saved to localStorage. Redirecting to index.html...');

          // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù‚Ø¨Ù„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          Swal.fire({
            icon: "success",
            title: "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!",
            html: `
      <p style="font-size: 1.1rem; color: #333;">Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ø¬Ø§Ù‡Ø² Ù„ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ ÙØ±ÙŠØ¯Ø©!</p>
      <div style="text-align: right; margin-top: 20px; padding-right: 15px; font-size: 1rem;">
        <p style="margin-bottom: 10px;">ğŸ›ï¸ ØªØµÙØ­ Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
        <p style="margin-bottom: 10px;">ğŸ’° ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­ØµØ±ÙŠØ©.</p>
        <p>âœ¨ Ø§ÙƒØªØ´Ù ÙƒÙ„ Ù…Ø§ Ù‡Ùˆ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø³ÙˆÙŠØ³ Ø¨Ø§Ø²Ø§Ø±.</p>
      </div>
    `,
              allowOutsideClick: false, // Ù…Ù†Ø¹ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            confirmButtonText: "Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
          }).then((result) => {
            // Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŒ ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (result.isConfirmed) {
            // âœ… ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
      // Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© (Header) Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.
            }
          });
        } else if (result && result.error) {
          console.warn('[Register] API returned an error:', result.error);
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… (Ù…Ø«Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ù…ÙƒØ±Ø±)
          showError(phone, result.error);

        } else {
          console.error('[Register] Unknown API failure.');
          // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø§Ù„Ø³Ø¨Ø¨ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
          showError(form, "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        }
      } catch (error) {
        Swal.close(); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø­Ø¯ÙˆØ« Ø®Ø·Ø£
        console.error("%c[Register] Critical error during registration:", 'color: red; font-weight: bold;', error);
        // Ù‡Ø°Ø§ Ø§Ù„Ø®Ø·Ø£ ÙŠØ­Ø¯Ø« Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯
        showError(form, "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.");
      }
    });

    // Ø¬Ø¯ÙŠØ¯: Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    const togglePasswordIcon = document.getElementById('toggle-password-icon');
    togglePasswordIcon.addEventListener('click', function () {
      // ØªØ¨Ø¯ÙŠÙ„ Ù†ÙˆØ¹ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
      password.setAttribute('type', type);

      // ØªØ¨Ø¯ÙŠÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹ÙŠÙ†
      this.classList.toggle('fa-eye');
      this.classList.toggle('fa-eye-slash');
    });
  </script>
</body>

</html>