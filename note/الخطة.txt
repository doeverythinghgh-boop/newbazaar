
الهدف
*********************  


يجب ان يظهر الجدول للبائع فقط ولا يظهر للادمن ولاكن لخدمه التوصيل is active من جدول suppliers_deliveries المسمحة للبائع اي خدمه التوصيل المرتبطة بالبائع مع حذف العمود الثالث قم باعداد خطة ارسلها للجنت كود لتنفيذ هذا التعديل 


*********************
الخطة المقترحة
*********************



لتحقيق الهدف المطلوب - وهو إظهار جدول sales-movement-modal__table delivery-table للبائع فقط، لعرض خدمات التوصيل النشطة المرتبطة به، مع حذف العمود الثالث - يجب تنفيذ التعديلات التالية بالتسلسل عبر ملفات المشروع.

المرحلة الأولى: تعديل الخادم (API) - جلب بيانات التوصيل المصفاة
تتم هذه التعديلات في ملفات مجلد api/ لضمان أن الخادم هو من يفرض منطق التصفية والأمان قبل إرسال البيانات:

في ملف api/suppliers-deliveries.js (أو ملف API المسؤول عن خدمات التوصيل):

يجب تعديل دالة معالجة طلب GET (الخاصة بجلب البيانات) لتصبح وظيفتها الرئيسية هي جلب خدمات التوصيل بناءً على مُعرِّف البائع وحالة التفعيل.

يجب أن يقوم الخادم أولاً بالتحقق من هوية المستخدم (البائع) عبر التوكن (Token) أو الجلسة لاستخراج sellerId (والذي يعادل supplier_id).

يُعدَّل استعلام قاعدة البيانات (Turso DB) ليشمل شرطين أساسيين في جملة WHERE:

supplier_id = [معرف البائع المُستخلَص]

is_active = 1

تُعاد الاستجابة إلى الواجهة الأمامية كـ JSON تحتوي فقط على مصفوفة خدمات التوصيل النشطة المرتبطة بالبائع المُسجَّل دخوله.

المرحلة الثانية: تعديل منطق الواجهة الأمامية (JavaScript)
تتم هذه التعديلات في ملفات JavaScript لضمان تطبيق منطق الدور وعرض البيانات المحدثة بشكل صحيح:

في ملف js/auth.js (أو الملف المسؤول عن إدارة الجلسات والأدوار):

يجب استخدام وظيفة getAuthUserRole() لتحديد ما إذا كان المستخدم الحالي هو Seller.

في ملف js/admin-page.js و/أو js/seller.js:

التحكم في العرض (Visibility):

في منطق تهيئة الصفحة (Initialization)، يُضاف شرط للتحقق من الدور.

إذا كان الدور هو Admin، يجب إخفاء زر تشغيل النافذة المنبثقة (Modal Trigger) الخاصة بحركة المشتريات/التوصيل.

إذا كان الدور هو Seller، يجب إظهار هذا الزر ليتمكن البائع من الوصول إليه.

في ملف js/purchases-modal.js (الملف المسؤول عن منطق النافذة المنبثقة):

تغيير مصدر البيانات: داخل الدالة المسؤولة عن فتح النافذة وتحميل البيانات (مثل openSalesMovementModal)، يتم تغيير استدعاء الـ API من نقطة النهاية القديمة الخاصة بحركة المشتريات العامة إلى نقطة النهاية الجديدة أو المعدلة في api/suppliers-deliveries.js.

تعديل وظيفة البناء (Rendering): تُعدَّل دالة إنشاء صفوف الجدول (renderMovementRow أو ما يماثلها) لتقوم بالتكرار على مصفوفة بيانات خدمات التوصيل الجديدة. عند بناء كل صف (<tr>) وكل خلية (<td>)، يتم تجاهل البيانات المخصصة للعمود الثالث ويُنشأ الصف بباقي الأعمدة فقط، مما يضمن التوافق مع الهيكل الجديد.

المرحلة الثالثة: تعديل هيكل الصفحة (HTML) والأنماط (CSS)
هذه التعديلات تضمن التناسق البصري للهيكل بعد حذف العمود الثالث:

في ملف admin.html (الجزء الذي يحتوي على هيكل النافذة المنبثقة):

إزالة رأس العمود: يتم تحديد وسم <th> (أو ما يماثله في حالة استخدام تخطيط Grid/Flexbox) الذي يمثل العنوان الخاص بـ العمود الثالث ضمن رأس الجدول (<thead>) الخاص بالجدول sales-movement-modal__table delivery-table ويتم حذفه تمامًا.

في ملف css/modal.css (أو ملف CSS المسؤول عن أنماط الجدول):

ضبط العرض: يجب مراجعة أنماط الجدول للتأكد من أن عرض الأعمدة المتبقية يملأ المساحة بشكل مناسب. إذا كان يتم استخدام خاصية مثل grid-template-columns أو width لتحديد عرض كل عمود، يجب تعديل هذه الخاصية لتعكس العدد الجديد من الأعمدة (التي أصبحت أقل بواحد).

هذه الخطة تشمل جميع نقاط الترابط اللازمة لضمان: التحكم في الوصول بناءً على الدور، تصفية البيانات في الخادم لضمان الأمان والفعالية، وتعديل الواجهة الأمامية لاستيعاب وحذف العمود غير المطلوب.






*********************

افهم الهدف والخطة المقترحة وحللها جيدا وقم بتنفيذ خطة متناسبة مع المشروع للوصول للهدف


