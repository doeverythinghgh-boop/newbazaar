<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… - ØµÙØ­Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <style>
        /* ============================================
           Reset & Base Styles
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', 'Arial', 'Tahoma', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            direction: rtl;
            text-align: right;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
            color: #0066cc;
        }

        /* ============================================
           CSS Variables (Theme)
           ============================================ */
        :root {
            --color-primary: #0066cc;
            --color-review: #ffa500;
            --color-confirmed: #4caf50;
            --color-shipped: #2196f3;
            --color-delivered: #00bcd4;
            --color-cancelled: #f44336;
            --color-rejected: #e91e63;
            --color-returned: #9c27b0;
            --color-full: #4caf50;
            --color-partial: #ff9800;
            --color-fail: #f44336;
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-light: #e0e0e0;
            --radius-lg: 8px;
            --radius-full: 50%;
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --transition-normal: 0.3s ease;
        }

        /* ============================================
           Stepper Styles
           ============================================ */
        .stepper-container {
            width: 100%;
            padding: 2rem 1rem;
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }

        .stepper-wrapper {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1rem 0;
        }

        .step-item {
            position: relative;
            flex: 1;
            min-width: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }

        .step-item:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 25px;
            right: 50%;
            width: 100%;
            height: 3px;
            background: var(--border-light);
            z-index: 1;
            transition: background var(--transition-normal);
        }

        .step-item.completed:not(:last-child)::after {
            background: var(--color-confirmed);
        }

        .step-item.active:not(:last-child)::after {
            background: linear-gradient(to left, var(--color-confirmed) 0%, var(--border-light) 100%);
        }

        .step-circle {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            background: var(--bg-secondary);
            border: 3px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--text-secondary);
            position: relative;
            z-index: 3;
            transition: all var(--transition-normal);
            cursor: pointer;
        }

        .step-item.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: #ffffff;
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.2);
        }

        .step-item.completed .step-circle {
            background: var(--color-confirmed);
            border-color: var(--color-confirmed);
            color: #ffffff;
        }

        .step-item.review .step-circle {
            background: var(--color-review);
            border-color: var(--color-review);
            color: #ffffff;
        }

        .step-item.confirmed .step-circle {
            background: var(--color-confirmed);
            border-color: var(--color-confirmed);
            color: #ffffff;
        }

        .step-item.shipped .step-circle {
            background: var(--color-shipped);
            border-color: var(--color-shipped);
            color: #ffffff;
        }

        .step-item.delivered .step-circle {
            background: var(--color-delivered);
            border-color: var(--color-delivered);
            color: #ffffff;
        }

        .step-item.cancelled .step-circle {
            background: var(--color-cancelled);
            border-color: var(--color-cancelled);
            color: #ffffff;
        }

        .step-item.rejected .step-circle {
            background: var(--color-rejected);
            border-color: var(--color-rejected);
            color: #ffffff;
        }

        .step-item.returned .step-circle {
            background: var(--color-returned);
            border-color: var(--color-returned);
            color: #ffffff;
        }

        .step-circle:hover {
            transform: scale(1.15);
        }

        .step-circle:focus {
            outline: 3px solid var(--color-primary);
            outline-offset: 2px;
        }

        .step-label {
            margin-top: 0.75rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
            transition: color var(--transition-normal);
        }

        .step-item.active .step-label {
            color: var(--color-primary);
            font-weight: 700;
        }

        .step-item.completed .step-label {
            color: var(--color-confirmed);
        }

        .step-description {
            margin-top: 0.25rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
            max-width: 150px;
        }

        .step-vendors {
            width: 100%;
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 6px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .step-vendors.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .vendors-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .vendor-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: var(--bg-primary);
            border-radius: 4px;
            border-right: 4px solid var(--border-light);
            transition: all var(--transition-normal);
        }

        .vendor-item:hover {
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            transform: translateX(-3px);
        }

        .vendor-item.full {
            border-right-color: var(--color-full);
        }

        .vendor-item.partial {
            border-right-color: var(--color-partial);
        }

        .vendor-item.fail {
            border-right-color: var(--color-fail);
        }

        .order-summary {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 6px;
        }

        .summary-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .summary-item {
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: 4px;
            text-align: center;
        }

        .summary-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stepper-wrapper {
                flex-direction: column;
                align-items: stretch;
            }
            
            .step-item {
                flex-direction: row;
                justify-content: flex-start;
                min-width: auto;
                padding: 0.5rem 0;
            }
            
            .step-item:not(:last-child)::after {
                display: none;
            }
            
            .step-item::before {
                content: '';
                position: absolute;
                right: 25px;
                top: 50px;
                bottom: -10px;
                width: 2px;
                background: var(--border-light);
            }
            
            .step-item:last-child::before {
                display: none;
            }
            
            .step-item.completed::before {
                background: var(--color-confirmed);
            }
            
            .step-circle {
                width: 40px;
                height: 40px;
                font-size: 1rem;
                margin-left: 1rem;
            }
            
            .step-label {
                margin-top: 0;
                text-align: right;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… - Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h1>
        <div id="user-role-info" style="text-align: center; margin-bottom: 1rem; padding: 0.75rem; background: #e3f2fd; border-radius: 6px; color: #1976d2; font-weight: 500;"></div>
        <main>
            <div id="stepper-container" class="stepper-container"></div>
        </main>
    </div>

    <script>
        /* ============================================
           Order Status Map - Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† JSON
           ============================================ */
        let OrderStatusMap = {};

        /* ============================================
           Helper Functions
           ============================================ */
        function getStatusById(statusId) {
            return OrderStatusMap[statusId] || null;
        }

        function getAllStatuses() {
            return Object.values(OrderStatusMap).sort((a, b) => a.order - b.order);
        }

        function isValidStatus(statusId) {
            return statusId in OrderStatusMap;
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ar-SA').format(num);
        }

        function getElement(id) {
            return document.getElementById(id);
        }

        /* ============================================
           Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
           ============================================ */
        function displayUserRoleInfo() {
            console.log('  â””â”€ ğŸ‘¤ displayUserRoleInfo: Ø¨Ø¯Ø¡ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±...');
            const roleInfoElement = getElement('user-role-info');
            if (!roleInfoElement) {
                console.error('  â””â”€ âŒ Ø¹Ù†ØµØ± user-role-info ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!appData.userRoles) {
                console.warn('  â””â”€ âš ï¸ userRoles ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ appData');
                roleInfoElement.innerHTML = `
                    <strong>Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©
                `;
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ userRoles
            if (!currentUserRole) {
                console.warn('  â””â”€ âš ï¸ currentUserRole ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
                roleInfoElement.innerHTML = `
                    <strong>Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ØºÙŠØ± Ù…Ø­Ø¯Ø¯
                `;
                return;
            }

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±
            const roleInfo = appData.userRoles[currentUserRole];
            
            if (roleInfo) {
                console.log(`  â””â”€ âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±: ${roleInfo.name}`);
                roleInfoElement.innerHTML = `
                    <strong>Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${roleInfo.name} 
                    <span style="margin: 0 0.5rem;">|</span>
                    <span style="font-size: 0.9rem; color: #555;">${roleInfo.description}</span>
                `;
                console.log(`  â””â”€ âœ… ØªÙ… Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø©`);
            } else {
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¯ÙˆØ±ØŒ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
                console.warn(`  â””â”€ âš ï¸ Ø§Ù„Ø¯ÙˆØ± "${currentUserRole}" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ userRoles. Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:`, Object.keys(appData.userRoles));
                roleInfoElement.innerHTML = `
                    <strong>Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${currentUserRole} (ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
                `;
            }
        }

        function createElement(tag, attributes = {}) {
            const element = document.createElement(tag);
            Object.keys(attributes).forEach(key => {
                if (key === 'className') {
                    element.className = attributes[key];
                } else {
                    element.setAttribute(key, attributes[key]);
                }
            });
            return element;
        }

        /* ============================================
           Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù JSON
           ============================================ */
        let appData = {
            ui: {},
            orderStatuses: {},
            userRoles: {},
            order: {},
            vendors: [],
            summary: {},
            deliveryServices: {},
            vendorStatusLabels: {},
            subStepStatusLabels: {}
        };
        
        /* ============================================
           Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ - Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† JSON
           ============================================ */
        let currentUserRole = 'BUYER';

        /* ============================================
           Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù JSON
           ============================================ */
        async function loadData() {
            try {
                console.log('ğŸš€ [1/8] Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† stepper-data.json...');
                const response = await fetch('stepper-data.json');
                if (!response.ok) {
                    throw new Error(appData.ui.messages?.fetchError || 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                console.log('âœ… [2/8] ØªÙ… Ø¬Ù„Ø¨ Ù…Ù„Ù JSON Ø¨Ù†Ø¬Ø§Ø­');
                const data = await response.json();
                console.log('âœ… [3/8] ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª JSON Ø¨Ù†Ø¬Ø§Ø­');
                appData = data;
                
                // ØªØ­ÙˆÙŠÙ„ orderStatuses Ø¥Ù„Ù‰ OrderStatusMap
                console.log('ğŸ“‹ [4/8] ØªØ­ÙˆÙŠÙ„ orderStatuses Ø¥Ù„Ù‰ OrderStatusMap...');
                OrderStatusMap = {};
                Object.keys(data.orderStatuses).forEach(key => {
                    OrderStatusMap[key] = data.orderStatuses[key];
                });
                console.log(`âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ ${Object.keys(OrderStatusMap).length} Ø­Ø§Ù„Ø© Ø·Ù„Ø¨`);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                if (data.ui && data.ui.title) {
                    console.log('ğŸ“ [5/8] ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©...');
                    const titleElement = document.querySelector('h1');
                    if (titleElement) {
                        titleElement.textContent = data.ui.title;
                        console.log(`âœ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: "${data.ui.title}"`);
                    }
                }
                
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                console.log('ğŸ“Š [6/8] ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©...');
                currentOrderStatus = data.order.currentStatus || 'REVIEW';
                console.log(`âœ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${currentOrderStatus}`);
                
                // ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† JSON
                console.log('ğŸ‘¤ [7/8] ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ...');
                // ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…ÙØªØ§Ø­ ÙÙŠ userRoles (Ù…Ø«Ù„: "BUYER", "VENDOR", "SHIPPER", "ADMIN")
                if (data.currentUserRole) {
                    currentUserRole = data.currentUserRole;
                    console.log(`ğŸ“Œ Ø§Ù„Ø¯ÙˆØ± Ù…Ù† JSON: "${currentUserRole}"`);
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¯ÙˆØ± ÙÙŠ userRoles
                    if (data.userRoles && !data.userRoles[currentUserRole]) {
                        console.warn(`âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„Ø¯ÙˆØ± "${currentUserRole}" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ userRoles. Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:`, Object.keys(data.userRoles));
                        console.warn(`âš ï¸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… "BUYER" ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.`);
                        currentUserRole = 'BUYER';
                    } else {
                        const roleInfo = data.userRoles[currentUserRole];
                        console.log(`âœ… Ø§Ù„Ø¯ÙˆØ± Ù…ÙˆØ¬ÙˆØ¯: "${roleInfo.name}" - ${roleInfo.description}`);
                    }
                } else {
                    console.warn('âš ï¸ ØªØ­Ø°ÙŠØ±: currentUserRole ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ JSON. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… "BUYER" ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.');
                    currentUserRole = 'BUYER'; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                }
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† appData ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ currentUserRole (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ)
                appData.currentUserRole = currentUserRole;
                
                // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                console.log('ğŸ“± [8/8] Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØµÙØ­Ø©...');
                displayUserRoleInfo();
                
                // Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                console.log('ğŸ¨ Ø¨Ø¯Ø¡ Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…...');
                renderStepper();
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const container = getElement('stepper-container');
                if (container) {
                    const errorMsg = appData.ui?.messages?.loadingError || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                    const fileNotFoundMsg = appData.ui?.messages?.fileNotFound || 'ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù stepper-data.json ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯';
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #f44336;">
                            <h3>${errorMsg}</h3>
                            <p>${error.message}</p>
                            <p style="font-size: 0.9rem; color: #666; margin-top: 1rem;">
                                ${fileNotFoundMsg}
                            </p>
                        </div>
                    `;
                }
            }
        }

        /* ============================================
           Stepper Functions
           ============================================ */
        let currentOrderStatus = 'REVIEW';

        function setCurrentOrderStatus(statusId) {
            console.log(`ğŸ”„ setCurrentOrderStatus: Ù…Ø­Ø§ÙˆÙ„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ ${statusId}`);
            if (!isValidStatus(statusId)) {
                const errorMsg = appData.ui?.messages?.invalidStatus || 'Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                console.error(`  â””â”€ âŒ Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©: ${statusId}`);
                alert(errorMsg);
                return false;
            }
            const oldStatus = currentOrderStatus;
            currentOrderStatus = statusId;
            console.log(`  â””â”€ âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† "${oldStatus}" Ø¥Ù„Ù‰ "${statusId}"`);
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ appData
            if (appData.order) {
                appData.order.currentStatus = statusId;
                appData.order.lastUpdated = new Date().toISOString();
                console.log(`  â””â”€ ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ« appData.order.currentStatus`);
            }
            console.log(`  â””â”€ ğŸ¨ Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…...`);
            renderStepper();
            return true;
        }

        function renderStepper() {
            console.log('  â””â”€ ğŸ“Š renderStepper: Ø¨Ø¯Ø¡ Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…...');
            const container = getElement('stepper-container');
            if (!container) {
                console.error('  â””â”€ âŒ renderStepper: Ø­Ø§ÙˆÙŠØ© stepper-container ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                return;
            }

            const allStatuses = getAllStatuses();
            console.log(`  â””â”€ ğŸ“‹ ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ${allStatuses.length} Ø­Ø§Ù„Ø© Ø·Ù„Ø¨`);
            const currentStatus = getStatusById(currentOrderStatus);
            console.log(`  â””â”€ ğŸ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${currentStatus?.name || currentOrderStatus} (${currentOrderStatus})`);

            // Create stepper wrapper
            let wrapper = container.querySelector('.stepper-wrapper');
            if (!wrapper) {
                console.log('  â””â”€ ğŸ†• Ø¥Ù†Ø´Ø§Ø¡ stepper-wrapper Ø¬Ø¯ÙŠØ¯');
                wrapper = createElement('div', { className: 'stepper-wrapper' });
                container.appendChild(wrapper);
            } else {
                console.log('  â””â”€ ğŸ”„ ØªÙ†Ø¸ÙŠÙ stepper-wrapper Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯');
                wrapper.innerHTML = '';
            }

            // Create step items
            console.log(`  â””â”€ ğŸ¨ Ø¥Ù†Ø´Ø§Ø¡ ${allStatuses.length} Ø¹Ù†ØµØ± Ø®Ø·ÙˆØ©...`);
            allStatuses.forEach((status, index) => {
                console.log(`    â””â”€ [${index + 1}/${allStatuses.length}] Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·ÙˆØ©: ${status.name} (${status.id})`);
                const stepItem = createStepItem(status, index, allStatuses.length);
                wrapper.appendChild(stepItem);
            });
            console.log(`  â””â”€ âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø®Ø·ÙˆØ§Øª (${allStatuses.length} Ø®Ø·ÙˆØ©)`);

            // Add order summary
            console.log('  â””â”€ ğŸ“Š Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨...');
            renderOrderSummary(container);
            console.log('  â””â”€ âœ… ØªÙ… Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
        }

        function createStepItem(status, index, totalSteps) {
            const stepItem = createElement('div', {
                className: 'step-item',
                'data-status': status.id
            });

            // Determine step state
            const currentStatus = getStatusById(currentOrderStatus);
            let stepClass = '';
            if (status.order < currentStatus.order) {
                stepClass = 'completed';
            } else if (status.order === currentStatus.order) {
                stepClass = 'active';
            }
            stepClass += ` ${status.id.toLowerCase()}`;

            stepItem.className = `step-item ${stepClass}`;
            
            // Log step state
            if (stepClass.includes('active')) {
                console.log(`      â””â”€ âœ… ${status.name}: Ù†Ø´Ø· (active)`);
            } else if (stepClass.includes('completed')) {
                console.log(`      â””â”€ âœ“ ${status.name}: Ù…ÙƒØªÙ…Ù„ (completed)`);
            } else {
                console.log(`      â””â”€ â—‹ ${status.name}: Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (pending)`);
            }

            // Step circle
            const circle = createElement('div', {
                className: 'step-circle',
                'aria-label': status.name,
                role: 'button',
                tabIndex: '0'
            });
            circle.textContent = status.icon;

            // Add click handler
            circle.addEventListener('click', () => {
                handleStepClick(status.id);
            });

            circle.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleStepClick(status.id);
                }
            });

            // Step label
            const label = createElement('div', { className: 'step-label' });
            label.textContent = status.name;

            // Step description
            const description = createElement('div', { className: 'step-description' });
            description.textContent = status.description;

            // Append to step item
            stepItem.appendChild(circle);
            stepItem.appendChild(label);
            stepItem.appendChild(description);

            return stepItem;
        }

        function handleStepClick(statusId) {
            console.log(`ğŸ–±ï¸ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø®Ø·ÙˆØ©: ${statusId}`);
            if (setCurrentOrderStatus(statusId)) {
                console.log(`  â””â”€ âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: ${statusId}`);
                // Show vendors if status is CONFIRMED or later
                if (statusId === 'CONFIRMED' || getStatusById(statusId).order > 2) {
                    console.log(`  â””â”€ ğŸ“‹ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ù„Ù„Ø®Ø·ÙˆØ©: ${statusId}`);
                    showVendorsForStep(statusId);
                } else {
                    console.log(`  â””â”€ ğŸ”’ Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† (Ø§Ù„Ø­Ø§Ù„Ø© Ù‚Ø¨Ù„ CONFIRMED)`);
                    hideVendorsForStep();
                }
            } else {
                console.log(`  â””â”€ âŒ ÙØ´Ù„ ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: ${statusId}`);
            }
        }

        function showVendorsForStep(statusId) {
            console.log(`  â””â”€ ğŸ“‹ showVendorsForStep: Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ù„Ù„Ø®Ø·ÙˆØ© ${statusId}`);
            const allStepItems = document.querySelectorAll('.step-item');
            console.log(`    â””â”€ ğŸ”„ Ø¥Ø®ÙØ§Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª (${allStepItems.length} Ø®Ø·ÙˆØ©)`);
            allStepItems.forEach(item => {
                const vendorsSection = item.querySelector('.step-vendors');
                if (vendorsSection) {
                    vendorsSection.classList.remove('show');
                }
            });

            const currentStepItem = document.querySelector(`[data-status="${statusId}"]`);
            if (!currentStepItem) {
                console.error(`    â””â”€ âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± Ø§Ù„Ø®Ø·ÙˆØ©: ${statusId}`);
                return;
            }

            let vendorsSection = currentStepItem.querySelector('.step-vendors');
            if (!vendorsSection) {
                console.log(`    â””â”€ ğŸ†• Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯`);
                vendorsSection = createVendorsSection();
                currentStepItem.appendChild(vendorsSection);
            } else {
                console.log(`    â””â”€ ğŸ”„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯`);
            }

            renderVendorsList(vendorsSection);
            vendorsSection.classList.add('show');
            console.log(`    â””â”€ âœ… ØªÙ… Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†`);
        }

        function hideVendorsForStep() {
            console.log(`  â””â”€ ğŸ”’ hideVendorsForStep: Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†`);
            const allVendorsSections = document.querySelectorAll('.step-vendors');
            console.log(`    â””â”€ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${allVendorsSections.length} Ù‚Ø³Ù… Ø¨Ø§Ø¦Ø¹ÙŠÙ†`);
            allVendorsSections.forEach(section => {
                section.classList.remove('show');
            });
            console.log(`    â””â”€ âœ… ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†`);
        }

        function createVendorsSection() {
            console.log(`      â””â”€ ğŸ†• createVendorsSection: Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†`);
            const section = createElement('div', { className: 'step-vendors' });
            const list = createElement('ul', { className: 'vendors-list' });
            section.appendChild(list);
            console.log(`      â””â”€ âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†`);
            return section;
        }

        function renderVendorsList(container) {
            const list = container.querySelector('.vendors-list');
            if (!list) return;

            list.innerHTML = '';

            if (!appData.vendors || appData.vendors.length === 0) {
                list.innerHTML = '<li style="text-align: center; color: #666; padding: 1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ø¦Ø¹ÙŠÙ†</li>';
                return;
            }

            appData.vendors.forEach(vendor => {
                const item = createElement('li', {
                    className: `vendor-item ${vendor.status.toLowerCase()}`
                });

                const vendorName = createElement('strong');
                vendorName.textContent = vendor.name;

                const vendorStatus = createElement('span');
                vendorStatus.style.marginRight = '1rem';
                vendorStatus.style.color = '#666';
                const statusLabel = appData.vendorStatusLabels?.[vendor.status] || vendor.statusLabel || vendor.status;
                vendorStatus.textContent = `(${statusLabel})`;

                item.appendChild(vendorName);
                item.appendChild(vendorStatus);
                list.appendChild(item);
            });
        }

        function renderOrderSummary(container) {
            console.log('  â””â”€ ğŸ“Š renderOrderSummary: Ø¨Ø¯Ø¡ Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨...');
            let summary = container.querySelector('.order-summary');
            if (!summary) {
                console.log('  â””â”€ ğŸ†• Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± order-summary Ø¬Ø¯ÙŠØ¯');
                summary = createElement('div', { className: 'order-summary' });
                container.appendChild(summary);
            }

            const orderData = appData.summary || {};
            const labels = appData.ui?.labels || {};
            
            console.log('  â””â”€ ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ:', {
                totalRequested: orderData.totalRequested,
                totalVendors: orderData.totalVendors,
                statusCounts: orderData.statusCounts
            });

            summary.innerHTML = `
                <div class="summary-title">${appData.ui?.summaryTitle || 'Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨'}</div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">${labels.totalRequested || 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'}</div>
                        <div class="summary-value">${formatNumber(orderData.totalRequested || 0)}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">${labels.totalVendors || 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†'}</div>
                        <div class="summary-value">${orderData.totalVendors || 0}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">${labels.fullSuccess || 'Ù†Ø¬Ø§Ø­ ÙƒØ§Ù…Ù„'}</div>
                        <div class="summary-value" style="color: var(--color-full)">${orderData.statusCounts?.FULL || 0}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">${labels.partialSuccess || 'Ù†Ø¬Ø§Ø­ Ø¬Ø²Ø¦ÙŠ'}</div>
                        <div class="summary-value" style="color: var(--color-partial)">${orderData.statusCounts?.PARTIAL || 0}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">${labels.failed || 'ÙØ´Ù„'}</div>
                        <div class="summary-value" style="color: var(--color-fail)">${orderData.statusCounts?.FAIL || 0}</div>
                    </div>
                </div>
            `;
            console.log('  â””â”€ âœ… ØªÙ… Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…...');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            loadData();
        });
    </script>
</body>
</html>

